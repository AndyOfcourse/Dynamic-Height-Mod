package net.multiverse.dynamicheight;@net.minecraftforge.fml.common.Mod("dynamicheight")public class DynamicHeightMod{public DynamicHeightMod(){var a=net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext.get().getModEventBus();a.addListener(this::a);a.addListener(this::b);}private void a(net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent e){c.b();e.enqueueWork(d::b);}private void b(net.minecraftforge.fml.event.lifecycle.FMLClientSetupEvent e){e.enqueueWork(()->{e();e0.a();f.a();});}static int g=-64,h=320;static void e(){g=-64;h=320;}static int i(int v){if(v<-2032)v=-2032;if(v>320)v=320;return v;}static int j(int v){if(v<320)v=320;if(v>2032)v=2032;return v;}static final class e0{static void a(){net.minecraftforge.common.MinecraftForge.EVENT_BUS.addListener(e0::b);}private static void b(net.minecraftforge.client.event.ClientPlayerNetworkEvent.LoggingIn e){c.a.sendToServer(new c.d(g,h));}}static final class f{static net.minecraft.client.gui.components.EditBox a,b;static void a(){net.minecraftforge.common.MinecraftForge.EVENT_BUS.addListener(f::b);net.minecraftforge.common.MinecraftForge.EVENT_BUS.addListener(f::c);}private static void b(net.minecraftforge.client.event.ScreenEvent.Init.Post e){var s=e.getScreen();if(!(s instanceof net.minecraft.client.gui.screens.worldselection.CreateWorldScreen))return;var m=net.minecraft.client.Minecraft.getInstance().font;a=new net.minecraft.client.gui.components.EditBox(m,20,45,80,20,net.minecraft.network.chat.Component.literal("Min"));a.setValue(""+g);a.setResponder(v->{try{g=i(Integer.parseInt(v));}catch(Exception x){}});e.addListener(a);b=new net.minecraft.client.gui.components.EditBox(m,20,95,80,20,net.minecraft.network.chat.Component.literal("Max"));b.setValue(""+h);b.setResponder(v->{try{h=j(Integer.parseInt(v));}catch(Exception x){}});e.addListener(b);}private static void c(net.minecraftforge.client.event.ScreenEvent.Render.Post e){var s=e.getScreen();if(!(s instanceof net.minecraft.client.gui.screens.worldselection.CreateWorldScreen))return;var p=e.getPoseStack();var m=net.minecraft.client.Minecraft.getInstance().font;m.draw(p,"Height Min",20,35,0xFFFFFF);m.draw(p,"Height Max",20,85,0xFFFFFF);if(!a.isFocused())a.setValue(""+g);if(!b.isFocused())b.setValue(""+h);}}static final class c{static int b=0;static final net.minecraftforge.network.simple.SimpleChannel a=net.minecraftforge.network.NetworkRegistry.newSimpleChannel(new net.minecraft.resources.ResourceLocation("dynamicheight","main"),()->"1","1"::equals,"1"::equals);static void b(){a.registerMessage(b++,d.class,d::a,d::b,d::c);}public static record d(int a,int b){static void a(d p,net.minecraft.network.FriendlyByteBuf buf){buf.writeInt(p.a());buf.writeInt(p.b());}static d b(net.minecraft.network.FriendlyByteBuf buf){return new d(buf.readInt(),buf.readInt());}static void c(d p,java.util.function.Supplier<net.minecraftforge.network.NetworkEvent.Context> s){var c=s.get();c.enqueueWork(()->{DynamicHeightMod.g=i(p.a());DynamicHeightMod.h=j(p.b());});c.setPacketHandled(true);}}}static final class d{static final java.util.Map<net.minecraft.resources.ResourceKey<net.minecraft.world.level.Level>,e> a=new java.util.concurrent.ConcurrentHashMap<>();static void b(){net.minecraftforge.common.MinecraftForge.EVENT_BUS.addListener(d::c);net.minecraftforge.common.MinecraftForge.EVENT_BUS.addListener(d::d);}private static void c(net.minecraftforge.event.level.LevelEvent.Load e0){var l=e0.getLevel();if(!(l instanceof net.minecraft.server.level.ServerLevel s))return;var t=s.getDataStorage();var x=t.computeIfAbsent(e::b,e::new,e.c());x.a(g,h);a.put(s.dimension(),x);e(s,x);}private static void d(net.minecraftforge.event.level.BlockEvent.EntityPlaceEvent e0){var l=e0.getLevel();if(!(l instanceof net.minecraft.server.level.ServerLevel s))return;var x=a.get(s.dimension());if(x==null)return;int y=e0.getPos().getY();if(y<x.a||y>=x.b)e0.setCanceled(true);}private static void e(net.minecraft.server.level.ServerLevel s,e d){var r=s.dimensionTypeRegistration();if(!(r instanceof net.minecraft.core.Holder.Reference ref))return;var o=(net.minecraft.world.level.dimension.DimensionType)ref.value();var n=new net.minecraft.world.level.dimension.DimensionType(o.fixedTime(),o.hasSkyLight(),o.hasCeiling(),o.ultraWarm(),o.natural(),o.coordinateScale(),o.bedWorks(),o.respawnAnchorWorks(),d.a,d.b-d.a,d.b-d.a,o.infiniburn(),o.effectsLocation(),o.ambientLight(),o.monsterSettings());ref.bindValue(n);}}static final class e extends net.minecraft.world.level.saveddata.SavedData{int a=-64,b=320;public e(){}public e(int x,int y){a=x;b=y;}void a(int x,int y){a=x;b=y;setDirty();}@Override public net.minecraft.nbt.CompoundTag save(net.minecraft.nbt.CompoundTag t){t.putInt("min",a);t.putInt("max",b);return t;}static e b(net.minecraft.nbt.CompoundTag t){return new e(t.getInt("min"),t.getInt("max"));}static String c(){return"dh";}}
}